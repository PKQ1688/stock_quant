<!DOCTYPE html>
<html style="height: 100%">

<head>
    <meta charset="utf-8">
</head>

<body style="height: 100%; margin: 0">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat/dist/ecStat.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/dataTool.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/bmap.min.js"></script>

    <h1>History</h1>
    start_date:<input value="2022-04-11" id="start_date">
    end_date:<input value="2023-04-20" id="end_date">
    user_id:<input value="wxt" id="user_id">
    stock_code :<input value="" id="stock_code">

    <input type="button" value="确定" onclick="get_records()"> <br />

    <div id="container" style="height: 100%;width:100%">
        <table id = "records">
            <tr>
                <th>user_id</th>
                <th>date</th>
                <th>stock_code</th>
                <th>stock_profit_rate</th>
                <th>profit_rate</th>
            </tr>
        </table>
    </div>

    <script type="text/javascript">
        var base_url = "http://172.22.67.15:9999";
        function get_records() {
            //清空之前的全局变量

            var url = base_url + "/get_records"
            start_date = document.getElementById("start_date").value;
            end_date = document.getElementById("end_date").value;
            user_id = document.getElementById("user_id").value;
            var request = new XMLHttpRequest();
            request.open("post", url);/*设置请求方法与路径*/
            request.setRequestHeader('Content-Type', 'application/json')
            request.send(JSON.stringify({
                "user_id": user_id,
                "start_date": start_date,
                "end_date": end_date,
            }));
            request.onload = function () {/*XHR对象获取到返回信息后执行*/
                if (request.status == 200) {/*返回状态为200，即为数据获取成功*/
                    //先清空除了head以外的records
                    var records = document.getElementById("records");
                    for (var i = records.rows.length - 1; i > 0; i--) {
                        records.deleteRow(i);
                    }
                    var response = JSON.parse(request.responseText);
                    for (var i = 0; i < response.length; i++) {
                        var record = response[i];
                        console.log(record);
                        var tr = document.createElement("tr");
                        for (var j = 0; j < record.length; j++) {
                            var td = document.createElement("td");
                            td.innerHTML = record[Object.keys(record)[j]];
                            tr.appendChild(td);
                        }
                        document.getElementById("records").appendChild(tr);

                    }
                };
            }
        }
        window.onload = get_records;
    </script>



</body>

</html>